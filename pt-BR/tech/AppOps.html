<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Operações de Aplicativo | Documentos do App Manager</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="A full-featured package manager and viewer for Android">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/AppManager/assets/css/0.styles.03a77600.css" as="style"><link rel="preload" href="/AppManager/assets/js/app.5333276d.js" as="script"><link rel="preload" href="/AppManager/assets/js/2.b7ff2a34.js" as="script"><link rel="preload" href="/AppManager/assets/js/41.a4a19a19.js" as="script"><link rel="prefetch" href="/AppManager/assets/js/10.d8e7f70f.js"><link rel="prefetch" href="/AppManager/assets/js/11.00fd8fa4.js"><link rel="prefetch" href="/AppManager/assets/js/12.6bb1b872.js"><link rel="prefetch" href="/AppManager/assets/js/13.e5167225.js"><link rel="prefetch" href="/AppManager/assets/js/14.f3a7ace7.js"><link rel="prefetch" href="/AppManager/assets/js/15.9ea5d27a.js"><link rel="prefetch" href="/AppManager/assets/js/16.6260068c.js"><link rel="prefetch" href="/AppManager/assets/js/17.ceb10401.js"><link rel="prefetch" href="/AppManager/assets/js/18.55b96b2d.js"><link rel="prefetch" href="/AppManager/assets/js/19.375eee66.js"><link rel="prefetch" href="/AppManager/assets/js/20.8ce11435.js"><link rel="prefetch" href="/AppManager/assets/js/21.7ee9b266.js"><link rel="prefetch" href="/AppManager/assets/js/22.f8fd7410.js"><link rel="prefetch" href="/AppManager/assets/js/23.d9953555.js"><link rel="prefetch" href="/AppManager/assets/js/24.da842f5f.js"><link rel="prefetch" href="/AppManager/assets/js/25.a801c44e.js"><link rel="prefetch" href="/AppManager/assets/js/26.68de90c2.js"><link rel="prefetch" href="/AppManager/assets/js/27.ee17ae71.js"><link rel="prefetch" href="/AppManager/assets/js/28.ed9bcb77.js"><link rel="prefetch" href="/AppManager/assets/js/29.f491c9b5.js"><link rel="prefetch" href="/AppManager/assets/js/3.d34c2821.js"><link rel="prefetch" href="/AppManager/assets/js/30.61b067e4.js"><link rel="prefetch" href="/AppManager/assets/js/31.9c6f4526.js"><link rel="prefetch" href="/AppManager/assets/js/32.b2c4b41d.js"><link rel="prefetch" href="/AppManager/assets/js/33.049ace3d.js"><link rel="prefetch" href="/AppManager/assets/js/34.5de71fb4.js"><link rel="prefetch" href="/AppManager/assets/js/35.6a948eab.js"><link rel="prefetch" href="/AppManager/assets/js/36.c15fe39b.js"><link rel="prefetch" href="/AppManager/assets/js/37.6f2380c5.js"><link rel="prefetch" href="/AppManager/assets/js/38.8e010f0c.js"><link rel="prefetch" href="/AppManager/assets/js/39.d67a1862.js"><link rel="prefetch" href="/AppManager/assets/js/4.fd7ebf95.js"><link rel="prefetch" href="/AppManager/assets/js/40.0bd893b3.js"><link rel="prefetch" href="/AppManager/assets/js/42.96602cb3.js"><link rel="prefetch" href="/AppManager/assets/js/43.f0ebc363.js"><link rel="prefetch" href="/AppManager/assets/js/44.1efc9551.js"><link rel="prefetch" href="/AppManager/assets/js/45.3a5f4e7d.js"><link rel="prefetch" href="/AppManager/assets/js/46.c4beb2eb.js"><link rel="prefetch" href="/AppManager/assets/js/47.f0a1768e.js"><link rel="prefetch" href="/AppManager/assets/js/48.fa5c0b3e.js"><link rel="prefetch" href="/AppManager/assets/js/49.c3295dbb.js"><link rel="prefetch" href="/AppManager/assets/js/5.ab9db4f1.js"><link rel="prefetch" href="/AppManager/assets/js/50.0b3309b9.js"><link rel="prefetch" href="/AppManager/assets/js/51.a100a877.js"><link rel="prefetch" href="/AppManager/assets/js/52.fc5c8c61.js"><link rel="prefetch" href="/AppManager/assets/js/53.2fdb2635.js"><link rel="prefetch" href="/AppManager/assets/js/54.8c04dcaa.js"><link rel="prefetch" href="/AppManager/assets/js/55.597a7772.js"><link rel="prefetch" href="/AppManager/assets/js/56.dab61140.js"><link rel="prefetch" href="/AppManager/assets/js/57.e53527e6.js"><link rel="prefetch" href="/AppManager/assets/js/58.59c42e69.js"><link rel="prefetch" href="/AppManager/assets/js/59.2f5e59b4.js"><link rel="prefetch" href="/AppManager/assets/js/6.2ab55e1c.js"><link rel="prefetch" href="/AppManager/assets/js/60.578a48a0.js"><link rel="prefetch" href="/AppManager/assets/js/61.00153ad9.js"><link rel="prefetch" href="/AppManager/assets/js/62.9288f8f7.js"><link rel="prefetch" href="/AppManager/assets/js/63.1db8b737.js"><link rel="prefetch" href="/AppManager/assets/js/64.97a3552a.js"><link rel="prefetch" href="/AppManager/assets/js/65.21ad16f1.js"><link rel="prefetch" href="/AppManager/assets/js/66.28fd43ba.js"><link rel="prefetch" href="/AppManager/assets/js/67.78e0e128.js"><link rel="prefetch" href="/AppManager/assets/js/68.32ff3201.js"><link rel="prefetch" href="/AppManager/assets/js/69.cd773c1f.js"><link rel="prefetch" href="/AppManager/assets/js/7.23213d96.js"><link rel="prefetch" href="/AppManager/assets/js/70.5ab85907.js"><link rel="prefetch" href="/AppManager/assets/js/71.52d05d66.js"><link rel="prefetch" href="/AppManager/assets/js/72.787639a4.js"><link rel="prefetch" href="/AppManager/assets/js/73.0b7c08a5.js"><link rel="prefetch" href="/AppManager/assets/js/74.c9fe519e.js"><link rel="prefetch" href="/AppManager/assets/js/75.7650fcc6.js"><link rel="prefetch" href="/AppManager/assets/js/76.05aaa81c.js"><link rel="prefetch" href="/AppManager/assets/js/77.490120ab.js"><link rel="prefetch" href="/AppManager/assets/js/78.1a52ae56.js"><link rel="prefetch" href="/AppManager/assets/js/79.711c77e2.js"><link rel="prefetch" href="/AppManager/assets/js/8.0f5d6b6d.js"><link rel="prefetch" href="/AppManager/assets/js/80.e1c15b40.js"><link rel="prefetch" href="/AppManager/assets/js/9.12e097cf.js">
    <link rel="stylesheet" href="/AppManager/assets/css/0.styles.03a77600.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/AppManager/pt-BR/" class="home-link router-link-active"><img src="/AppManager/icon.png" alt="Documentos do App Manager" class="logo"> <span class="site-name can-hide">Documentos do App Manager</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/AppManager/pt-BR/guide/" class="nav-link">
  Instruções
</a></div><div class="nav-item"><a href="/AppManager/pt-BR/changelog.html" class="nav-link">
  Histórico de Atualizações
</a></div><div class="nav-item"><a href="https://f-droid.org/packages/io.github.muntashirakon.AppManager" target="_blank" rel="noopener noreferrer" class="nav-link external">
  F-Droid
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/MuntashirAkon/AppManager" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Código Fonte
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Idiomas" class="dropdown-title"><span class="title">Idiomas</span> <span class="arrow down"></span></button> <button type="button" aria-label="Idiomas" class="mobile-dropdown-title"><span class="title">Idiomas</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/AppManager/tech/AppOps.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/AppManager/pt-BR/tech/AppOps.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Português (Brasil)
</a></li><li class="dropdown-item"><!----> <a href="/AppManager/ru/tech/AppOps.html" class="nav-link">
  Русский
</a></li><li class="dropdown-item"><!----> <a href="/AppManager/zh-CN/tech/AppOps.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/AppManager/pt-BR/guide/" class="nav-link">
  Instruções
</a></div><div class="nav-item"><a href="/AppManager/pt-BR/changelog.html" class="nav-link">
  Histórico de Atualizações
</a></div><div class="nav-item"><a href="https://f-droid.org/packages/io.github.muntashirakon.AppManager" target="_blank" rel="noopener noreferrer" class="nav-link external">
  F-Droid
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/MuntashirAkon/AppManager" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Código Fonte
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Idiomas" class="dropdown-title"><span class="title">Idiomas</span> <span class="arrow down"></span></button> <button type="button" aria-label="Idiomas" class="mobile-dropdown-title"><span class="title">Idiomas</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/AppManager/tech/AppOps.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/AppManager/pt-BR/tech/AppOps.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Português (Brasil)
</a></li><li class="dropdown-item"><!----> <a href="/AppManager/ru/tech/AppOps.html" class="nav-link">
  Русский
</a></li><li class="dropdown-item"><!----> <a href="/AppManager/zh-CN/tech/AppOps.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Instruções</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AppManager/pt-BR/guide/" class="sidebar-link">Introdução</a></li><li><a href="/AppManager/pt-BR/guide/adb-over-tcp.html" class="sidebar-link">ADB sobre TCP</a></li><li><a href="/AppManager/pt-BR/guide/main-page.html" class="sidebar-link">Página Principal</a></li><li><a href="/AppManager/pt-BR/guide/app-details-page.html" class="sidebar-link">Página de Detalhes do Aplicativo</a></li><li><a href="/AppManager/pt-BR/guide/one-click-ops-page.html" class="sidebar-link">Operações em 1 Clique</a></li><li><a href="/AppManager/pt-BR/guide/scanner-page.html" class="sidebar-link">Página de Scanner</a></li><li><a href="/AppManager/pt-BR/guide/shared-pref-editor-page.html" class="sidebar-link">Página de Edição de Preferências Compartilhadas</a></li><li><a href="/AppManager/pt-BR/guide/settings-page.html" class="sidebar-link">Página de Configurações</a></li><li><a href="/AppManager/pt-BR/guide/backup-restore.html" class="sidebar-link">Backup/Restauração</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/AppManager/pt-BR/faq" class="sidebar-heading clickable"><span>Perguntas Frequentes</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/AppManager/pt-BR/faq/app-components.html" class="sidebar-link">Componentes de Aplicativo</a></li><li><a href="/AppManager/pt-BR/faq/adb.html" class="sidebar-link">ADB sobre TCP</a></li><li><a href="/AppManager/pt-BR/faq/misc.html" class="sidebar-link">Miscelânea</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/AppManager/pt-BR/tech" class="sidebar-heading clickable router-link-active open"><span>Informações Técnicas</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/AppManager/pt-BR/tech/AppOps.html" aria-current="page" class="active sidebar-link">Operações de Aplicativo</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/AppManager/pt-BR/tech/AppOps.html#plano-de-fundo" class="sidebar-link">Plano de Fundo</a></li><li class="sidebar-sub-header"><a href="/AppManager/pt-BR/tech/AppOps.html#introducao-as-operacoes-de-aplicativo" class="sidebar-link">Introdução às Operações de Aplicativo</a></li><li class="sidebar-sub-header"><a href="/AppManager/pt-BR/tech/AppOps.html#gerenciador-de-operacoes-de-aplicativo" class="sidebar-link">Gerenciador de Operações de Aplicativo</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/AppManager/pt-BR/tech/AppOps.html#constantes-op" class="sidebar-link">Constantes OP_*</a></li><li class="sidebar-sub-header"><a href="/AppManager/pt-BR/tech/AppOps.html#constantes-mode" class="sidebar-link">Constantes MODE_*</a></li><li class="sidebar-sub-header"><a href="/AppManager/pt-BR/tech/AppOps.html#pacote-de-operacoes" class="sidebar-link">Pacote de Operações</a></li><li class="sidebar-sub-header"><a href="/AppManager/pt-BR/tech/AppOps.html#opentry" class="sidebar-link">OpEntry</a></li><li class="sidebar-sub-header"><a href="/AppManager/pt-BR/tech/AppOps.html#uso" class="sidebar-link">Uso</a></li></ul></li><li class="sidebar-sub-header"><a href="/AppManager/pt-BR/tech/AppOps.html#servicos-de-operacoes-de-aplicativo" class="sidebar-link">Serviços de Operações de Aplicativo</a></li><li class="sidebar-sub-header"><a href="/AppManager/pt-BR/tech/AppOps.html#appops-xml" class="sidebar-link">appops.xml</a></li><li class="sidebar-sub-header"><a href="/AppManager/pt-BR/tech/AppOps.html#interface-de-linha-de-comando-appops" class="sidebar-link">interface de linha de comando appops</a></li></ul></li><li><a href="/AppManager/pt-BR/tech/rules-specification.html" class="sidebar-link">App Manager: Especificação das Regras</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="operacoes-de-aplicativo"><a href="#operacoes-de-aplicativo" class="header-anchor">#</a> Operações de Aplicativo</h1> <p><em>Vá para a <a href="https://github.com/MuntashirAkon/AppManager/issues/17" target="_blank" rel="noopener noreferrer">questão relacionada<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> para discussão.</em></p> <details class="custom-block details"><summary>Tabela de Conteúdos</summary> <p></p><div class="table-of-contents"><ul><li><a href="#plano-de-fundo">Plano de Fundo</a></li><li><a href="#introducao-as-operacoes-de-aplicativo">Introdução às Operações de Aplicativo</a></li><li><a href="#gerenciador-de-operacoes-de-aplicativo">Gerenciador de Operações de Aplicativo</a><ul><li><a href="#constantes-op">Constantes OP_*</a></li><li><a href="#constantes-mode">Constantes MODE_*</a></li><li><a href="#pacote-de-operacoes">Pacote de Operações</a></li><li><a href="#opentry">OpEntry</a></li><li><a href="#uso">Uso</a></li></ul></li><li><a href="#servicos-de-operacoes-de-aplicativo">Serviços de Operações de Aplicativo</a></li><li><a href="#appops-xml">appops.xml</a></li><li><a href="#interface-de-linha-de-comando-appops">interface de linha de comando appops</a></li></ul></div><p></p></details> <h2 id="plano-de-fundo"><a href="#plano-de-fundo" class="header-anchor">#</a> Plano de Fundo</h2> <p><strong>App Ops</strong> (abreviação para <strong>Operações de Aplicativo</strong>) são usadas pelo sistema Android (desde o Android 4.3) para controlar as permissões do aplicativo. O usuário <em>pode</em> controlar algumas permissões, mas apenas as permissões que são consideradas perigosas (e o Google acha que saber seu número de telefone não é uma coisa perigosa). Assim, as operações de aplicativo parecem ser o que precisamos se quisermos instalar aplicativos como o Facebook e o Messenger (que registra literalmente tudo) e ainda quiser ter <em>alguma</em> privacidade e/ou segurança. Embora certas funções das operações de aplicativo estivessem disponíveis nas Configurações e mais tarde nas configurações ocultas na versão mais antiga do Android, isso está completamente escondido em versões mais recentes do Android e continuará a ser mantido escondido. Agora, qualquer aplicativo com a permissão <strong>android.Manifest.permission.GET_APP_OPS_STATS</strong> pode obter informações sobre as operações de aplicativo para outros aplicativos, mas essa permissão está oculta dos usuários e só pode ser ativada usando ADB ou root. Ainda assim, o aplicativo com essa permissão não pode conceder ou revogar permissões (na verdade modo de operação) para aplicativos que não sejam eles mesmos (com capacidade limitada, é claro). Para modificar as operações de outro aplicativo, o aplicativo precisa das permissões <strong>android.Manifest.permission.UPDATE_APP_OPS_STATS</strong> que não são acessíveis via comando <em>pm</em>. Assim, você não pode concedê-lo via root ou ADB, a permissão só é concedida aos aplicativos do sistema. Há muito poucos aplicativos que suportam desativar permissões via operações de aplicativo. O melhor que conheço é o <a href="https://github.com/8enet/AppOpsX" target="_blank" rel="noopener noreferrer">AppOpsX<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. A principal diferença (visível) entre meu aplicativo (AppManager) e este aplicativo é que o posterior também fornece a capacidade de revogar permissões de internet (escrevendo tabelas de ip). Outra diferença é que o autor usou a API oculta para acessar/conceder/revogar as operações, enquanto eu usei a ferramenta de linha de comando <a href="#interface-de-linha-de-comando-appops"><em>appops</em></a> para isso. Eu fiz isso por causa do limite de <a href="https://stackoverflow.com/questions/37628" target="_blank" rel="noopener noreferrer">Reflexão<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> que o Android recentemente impôs que tornou muitas APIs ocultas inutilizáveis (existem alguns hacks, mas eles podem não funcionar após o lançamento final do R, eu acredito). Um problema crucial que enfrentei durante o desenvolvimento de uma API para Operações de Aplicativo foi a falta de documentação em Inglês.</p> <h2 id="introducao-as-operacoes-de-aplicativo"><a href="#introducao-as-operacoes-de-aplicativo" class="header-anchor">#</a> Introdução às Operações de Aplicativo</h2> <img src="/AppManager/assets/how_app_ops_work.png" alt="Como o AppOps Funciona"> <p>A figura (tirada deste <a href="https://translate.googleusercontent.com/translate_c?depth=2&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=auto&amp;sp=nmt4&amp;tl=en&amp;u=https://www.cnblogs.com/0616--ataozhijia/p/5009718.html&amp;usg=ALkJrhgSo4IcKp2cXJlqttXuiRJZGa_jnw" target="_blank" rel="noopener noreferrer">artigo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) acima descreve o processo de alteração e processamento de permissões. O <a href="#gerenciador-de-operacoes-de-aplicativo"><strong>Gerenciador de Operações de Aplicativo</strong></a> pode ser usado para gerenciar permissões nas Configurações do aplicativo. O <strong>Gerenciador de Operações de Aplicativo</strong> também é útil para determinar se uma determinada permissão (ou operação) foi concedida ao aplicativo. A maioria dos métodos do <strong>Gerenciador de Operações de Aplicativo</strong> são acessíveis ao aplicativo do usuário, mas ao contrário de um aplicativo do sistema, ele só pode ser usado para verificar permissões para qualquer aplicativo ou para o próprio aplicativo e iniciar ou encerrar certas operações. Além disso, nem todas as operações são realmente acessíveis a partir desta classe Java. O <strong>Gerenciador de Operações de Aplicativo</strong> detém todas as constantes necessárias, como <a href="#constantes-op"><em>OP_*</em></a>, <code>OPSTR_*</code>, <a href="#constantes-mode"><em>MODE_*</em></a> que descreve código de operação, sequência de operação e modo de operações, respectivamente. Também mantém estuturas de dados necessárias, como <a href="#pacote-de-operacoes"><strong>PackageOps</strong></a> e <strong>OpEntry</strong>. <strong>PackageOps</strong> mantém <strong>OpEntry</strong> para um pacote, e <strong>OpEntry</strong>, como o nome sugere, descreve cada operação. Por baixo dos panos, o <strong>Gerenciador de Operações de Aplicativo</strong> chama o <strong>Serviço de Operações de Aplicativo</strong> para realizar qualquer trabalho real.</p> <p>O <a href="https://android.googlesource.com/platform/frameworks/base/+/master/services/core/java/com/android/server/appop/AppOpsService.java" target="_blank" rel="noopener noreferrer"><strong>Serviço de Operações de Aplicativo</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> é completamente oculto de um aplicativo de usuário, mas acessível para os aplicativos do sistema. Como visto na foto, esta é a classe que realmente gerencía as coisas. Contém estruturas de dados como <strong>Ops</strong> para armazenar informações básicas do pacote e <strong>Op</strong> que é semelhante a <strong>OpEntry</strong> do <strong>Gerenciador de Operações de Aplicativo</strong>. Ele também tem <strong>Shell</strong> que é, na verdade, o código fonte da ferramenta de linha de comando <em>appops</em>. Ele grava configurações para ou lê configurações do <a href="#appops-xml">/data/system/appops.xml</a>. Os serviços do sistema chama o <strong>Serviço de Operações de Aplicativo</strong> para descobrir o que um aplicativo é permitido e o que não é permitido realizar, e o <strong>Serviço de Operações de Aplicativo</strong> determina essas permissões analisando <code>/data/system/appops.xml</code>. Se nenhum valor personalizado for definido em <em>appops.xml</em>, ele retorna ao modo padrão disponível no <strong>Gerenciador de Operações de Aplicativo</strong>.</p> <h2 id="gerenciador-de-operacoes-de-aplicativo"><a href="#gerenciador-de-operacoes-de-aplicativo" class="header-anchor">#</a> Gerenciador de Operações de Aplicativo</h2> <p><a href="https://android.googlesource.com/platform/frameworks/base/+/master/core/java/android/app/AppOpsManager.java" target="_blank" rel="noopener noreferrer">AppOpsManager<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> significa gerenciador de operações de aplicativo. Consiste em várias constantes e classes para modificar as operações de aplicativo. A documentação oficial pode ser encontrada <a href="https://developer.android.com/reference/android/app/AppOpsManager" target="_blank" rel="noopener noreferrer">aqui<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="constantes-op"><a href="#constantes-op" class="header-anchor">#</a> Constantes OP_*</h3> <p><code>OP_*</code> são as constantes inteiras a partir de <code>0</code>. <code>OP_NONE</code> implica que nenhuma operação é especificada, enquanto <code>_NUM_OP</code> denota o número de operações definidas no prefixo <code>OP_*</code>.  Isso denota cada operação. Mas essas operações não são necessariamente únicas. Na verdade, há muitas operações que são realmente uma única operação denotada por múltiplas constantes <code>OP_*</code> (possivelmente para uso futuro). Os fornecedores podem definir sua própria operação com base em suas necessidades. A MIUI é um dos fornecedores que são conhecidos por fazer isso.</p> <p><em>Uma pequena espiada sobre <code>OP_*</code>:</em></p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br></div><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> OP_NONE <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> OP_COARSE_LOCATION <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> OP_FINE_LOCATION <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> OP_GPS <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> OP_VIBRATE <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> OP_READ_DEVICE_IDENTIFIERS <span class="token operator">=</span> <span class="token number">89</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> OP_ACCESS_MEDIA_LOCATION <span class="token operator">=</span> <span class="token number">90</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> OP_ACTIVATE_PLATFORM_VPN <span class="token operator">=</span> <span class="token number">91</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _NUM_OP <span class="token operator">=</span> <span class="token number">92</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Se uma operação é única, é definida por <a href="https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/app/AppOpsManager.java;drc=44cbdec292c6b234d94aae59257721cf499989ba;bpv=1;bpt=1;l=211?q=AppOpsManager&amp;ss=android%2Fplatform%2Fsuperproject&amp;gsn=sOpToSwitch&amp;gs=kythe%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fsuperproject%3Flang%3Djava%3Fpath%3Dandroid.app.AppOpsManager%238ffb80c9b09fce58d7fe1a0af7d50fd025765d8f41e838fa3bc2754dd99d9c48" target="_blank" rel="noopener noreferrer"><code>sOpToSwitch</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Ele mapeia cada operação para outra operação ou para si mesma (se for uma operação única). Por exemplo,, <code>OP_FINE_LOCATION</code> e <code>OP_GPS</code> são mapeadas para <code>OP_COARSE_LOCATION</code>.</p> <p>Cada operação tem um nome privado que são descritos por <a href="https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/app/AppOpsManager.java;drc=44cbdec292c6b234d94aae59257721cf499989ba;bpv=1;bpt=1;l=311?gsn=sOpNames&amp;gs=kythe%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fsuperproject%3Flang%3Djava%3Fpath%3Dandroid.app.AppOpsManager%234f77b221ad3e5d9212e217eadec0b78cd35717a3bf2d0f2bc642dea241e02d72" target="_blank" rel="noopener noreferrer"><code>sOpNames</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Esses nomes são geralmente os mesmos nomes das constantes sem o prefixo <code>OP_</code>. Algumas operações têm nomes públicos, bem como que são descritos por <code>sOpToString</code>. Por exemplo, <code>OP_COARSE_LOCATION</code> tem o nome público <strong>android:coarse_location</strong>.</p> <p>Como um processo gradual de movimentação de permissões para operações de aplicativo, já existem muitas permissões que são definidas em algumas operações. Essas permissões são mapeadas em <a href="https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/app/AppOpsManager.java;drc=44cbdec292c6b234d94aae59257721cf499989ba;bpv=1;bpt=1;l=361?gsn=sOpPerms&amp;gs=kythe%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fsuperproject%3Flang%3Djava%3Fpath%3Dandroid.app.AppOpsManager%23230bc1462b07a3c1575477761782a9d3537d75b4ea0a16748082c74f50bc2814" target="_blank" rel="noopener noreferrer"><code>sOpPerms</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Por exemplo, a permissão <strong>android.Manifest.permission.ACCESS_COARSE_LOCATION</strong> é mapeada para <code>OP_COARSE_LOCATION</code>. Algumas operações podem não ter quaisquer permissões associadas que tenham valores <code>null</code>.</p> <p>Como descrito na seção anterior, as operações configuradas para um aplicativo são armazenadas em <a href="#appops-xml">/data/system/appops.xml</a>. Se uma operação não estiver configurada, então o sistema permitirá que essa operação seja determinada a partir de <a href="https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/app/AppOpsManager.java;drc=44cbdec292c6b234d94aae59257721cf499989ba;bpv=1;bpt=1;l=410?gsn=sOpDefaultMode&amp;gs=kythe%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fsuperproject%3Flang%3Djava%3Fpath%3Dandroid.app.AppOpsManager%23a8c8e4e247453a8ce329b2c1130f9c7a7f91e2b97d159c3e18c768b4d42f1b75" target="_blank" rel="noopener noreferrer"><code>sOpDefaultMode</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Ele lista o <em>modo padrão</em> para cada operação.</p> <h3 id="constantes-mode"><a href="#constantes-mode" class="header-anchor">#</a> Constantes MODE_*</h3> <p>Constantes <code>MODE_*</code> também constantes inteiras a partir de <code>0</code>. Essas constantes são atribuídas a cada operação descrevendo se um aplicativo está autorizado a realizar essa operação. Esses modos geralmente têm nomes associados, como <strong>allow</strong> para <code>MODE_ALLOWED</code>, <strong>ignore</strong> para <code>MODE_IGNORED</code>, <strong>deny</strong> para <code>MODE_ERRORED</code> (um termo um pouco errado), <strong>default</strong> para <code>MODE_DEFAULT</code> e <strong>foreground</strong> para <code>MODE_FOREGROUND</code>.</p> <p><em>Modos padrão:</em></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * o chamador fornecido é autorizado a realizar a operação fornecida.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MODE_ALLOWED <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * o chamador fornecido não está autorizado a realizar a operação fornecida, e esta tentativa deve
 * &lt;em&gt;falhar silenciosamente&lt;/em&gt; (ele não deve fazer com que o aplicativo caia).
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MODE_IGNORED <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * o chamador fornecido não está autorizado a realizar a operação fornecida, e esta tentativa deve
 * porque ele tem um erro fatal, tipicamente um {@link SecurityException}.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MODE_ERRORED <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 2</span>
<span class="token comment">/**
 * o chamador deve usar sua verificação de segurança padrão. Este modo não é normalmente usado
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MODE_DEFAULT <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * Modo especial que significa &quot;permitir apenas quando o aplicativo estiver em primeiro plano.&quot;
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MODE_FOREGROUND <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>Além desses modos padrão, os fornecedores podem definir modos personalizados, como <code>MODE_ASK</code> (com o nome <strong>ask</strong>) que é usado ativamente pela MIUI. A MIUI também usa alguns outros modos sem qualquer nome associado a eles.</p> <h3 id="pacote-de-operacoes"><a href="#pacote-de-operacoes" class="header-anchor">#</a> Pacote de Operações</h3> <p><strong>AppOpsManager.PackageOps</strong> é uma estrutura de dados para armazenar todos as <strong>OpEntry</strong> para um pacote. Em termos simples, armazena todas as operações personalizadas para um pacote.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">PackageOps</span> <span class="token keyword">implements</span> <span class="token class-name">Parcelable</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> mPackageName<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> mUid<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OpEntry</span><span class="token punctuation">&gt;</span></span> mEntries<span class="token punctuation">;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Como pode ser visto acima, ele armazena todas as <strong>OpEntry</strong> para um pacote, bem como o nome do pacote correspondente e seu ID de usuário do kernel.</p> <h3 id="opentry"><a href="#opentry" class="header-anchor">#</a> OpEntry</h3> <p><strong>AppOpsManager.OpEntry</strong> é uma estrutura de dados que armazena uma única operação para qualquer pacote.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">OpEntry</span> <span class="token keyword">implements</span> <span class="token class-name">Parcelable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> mOp<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> mRunning<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token annotation punctuation">@Mode</span> <span class="token keyword">int</span> mMode<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">LongSparseLongArray</span> mAccessTimes<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">LongSparseLongArray</span> mRejectTimes<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">LongSparseLongArray</span> mDurations<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">LongSparseLongArray</span> mProxyUids<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">LongSparseArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> mProxyPackageNames<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Aqui:</p> <ul><li><code>mOp</code>: Denota uma das constantes <a href="#constantes-op"><code>OP_*</code></a>.</li> <li><code>mRunning</code>: Se as operações estão em andamento (ou seja, a operação começou, mas ainda não terminou). Nem todas as operações podem ser iniciadas ou concluídas assim.</li> <li><code>mMOde</code>: Uma das constantes <a href="#constantes-mode"><code>MODE_*</code></a>.</li> <li><code>mAccessTimes</code>: Armazena todos os horários de acesso disponíveis</li> <li><code>mRejectTimes</code>: Armazena todos os horários de rejeição disponíveis</li> <li><code>mDurations</code>: Todas as durações de acesso disponíveis, verificando isso com <code>mRunning</code> lhe dirá por quanto tempo o aplicativo está realizando uma determinada operação de aplicativo.</li> <li><code>mProxyUids</code>: Nenhuma documentação encontrada</li> <li><code>mProxyPackageNames:</code> Nenhuma documentação encontrada</li></ul> <h3 id="uso"><a href="#uso" class="header-anchor">#</a> Uso</h3> <p>TAREFAS</p> <h2 id="servicos-de-operacoes-de-aplicativo"><a href="#servicos-de-operacoes-de-aplicativo" class="header-anchor">#</a> Serviços de Operações de Aplicativo</h2> <p>TAREFAS</p> <h2 id="appops-xml"><a href="#appops-xml" class="header-anchor">#</a> appops.xml</h2> <p>As últimas <code>appops.xml</code> tem o seguinte formato: (Este DTD é feito por mim e não está perfeito, tem problemas de compatibilidade.)</p> <div class="language-dtd line-numbers-mode"><pre class="language-text"><code>&lt;!DOCTYPE app-ops [

&lt;!ELEMENT app-ops (uid|pkg)*&gt;
&lt;!ATTLIST app-ops v CDATA #IMPLIED&gt;

&lt;!ELEMENT uid (op)*&gt;
&lt;!ATTLIST uid n CDATA #REQUIRED&gt;

&lt;!ELEMENT pkg (uid)*&gt;
&lt;!ATTLIST pkg n CDATA #REQUIRED&gt;

&lt;!ELEMENT uid (op)*&gt;
&lt;!ATTLIST uid
n CDATA #REQUIRED
p CDATA #IMPLIED&gt;

&lt;!ELEMENT op (st)*&gt;
&lt;!ATTLIST op
n CDATA #REQUIRED
m CDATA #REQUIRED&gt;

&lt;!ELEMENT st EMPTY&gt;
&lt;!ATTLIST st
n CDATA #REQUIRED
t CDATA #IMPLIED
r CDATA #IMPLIED
d CDATA #IMPLIED
pp CDATA #IMPLIED
pu CDATA #IMPLIED&gt;

]&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>As instruções abaixo seguem a ordem exata dada acima:</p> <ul><li><code>app-ops</code>: O elemento root. Ele pode conter qualquer número de <code>pkg</code> ou pacote <code>uid</code> <ul><li><code>v</code>: (opcional, número inteiro) O número da versão (padrão: <code>NO_VERSION</code> ou <code>-1</code>)</li></ul></li> <li><code>pkg</code>: Armazena informações do pacote. Ele pode conter qualquer número do <code>uid</code> <ul><li><code>n</code>: (necessário, string) Nome do pacote</li></ul></li> <li>Pacote <code>uid</code>: Pacotes de lojas ou informações sobre pacotes
<ul><li><code>n</code>: (necessário, número inteiro) O ID do usuário</li></ul></li> <li><code>uid</code>: O ID do pacote do usuário. Ele pode conter qualquer número de <code>op</code> <ul><li><code>n</code>: (necessário, número inteiro) O ID do usuário</li> <li><code>p</code>: (optional, boolean) Se o aplicativo é um aplicativo privado/do sistema</li></ul></li> <li><code>op</code>: A operação pode conter <code>st</code> ou nada
<ul><li><code>n</code>: (necessário, número inteiro) O nome da operação em inteiro, ou seja. AppOpsManager.OP_*</li> <li><code>m</code>: (necessário, número inteiro) O modo da operação, ou seja. AppOpsManager.MODE_*</li></ul></li> <li><code>st</code>: Estado de funcionamento: se a operação é acessada, rejeitada ou em execução (não disponível em versões antigas)
<ul><li><code>n</code>: (necessário, longo) Chave contendo flags e uid</li> <li><code>t</code>: (opcional, longo) Tempo de acesso (padrão: <code>0</code>)</li> <li><code>r</code>: (opcional, longo) Tempo de rejeição (padrão: <code>0</code>)</li> <li><code>d</code>: (opcional, longo) Duração do acesso (padrão: <code>0</code>)</li> <li><code>pp</code>: (opcional, string) Nome do pacote proxy</li> <li><code>pu</code>: (opcional, número inteiro) Pacote uid do proxy</li></ul></li></ul> <p>Esta definição pode ser encontrada em <a href="https://android.googlesource.com/platform/frameworks/base/+/master/services/core/java/com/android/server/appop/AppOpsService.java" target="_blank" rel="noopener noreferrer"><strong>AppOpsService</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="interface-de-linha-de-comando-appops"><a href="#interface-de-linha-de-comando-appops" class="header-anchor">#</a> interface de linha de comando appops</h2> <p><code>appops</code> ou <code>cmd appops</code> (nas versões mais recentes) pode ser acessado via ADB ou root. Este é um método mais fácil de obter ou atualizar qualquer operação para um pacote (desde que o nome do pacote seja conhecido). A página de ajuda deste comando é auto explicativa:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Comandos do serviço de Operações de Aplicativo (appops):
help
  Escreva este texto para receber ajuda.
start [--user &lt;USER_ID&gt;] &lt;PACKAGE | UID&gt; &lt;OP&gt; 
  Inicia uma determinada operação para um determinado aplicativo.
stop [--user &lt;USER_ID&gt;] &lt;PACKAGE | UID&gt; &lt;OP&gt; 
  Interrompe uma determinada operação para um determinado aplicativo.
set [--user &lt;USER_ID&gt;] &lt;[--uid] PACKAGE | UID&gt; &lt;OP&gt; &lt;MODE&gt;
  Define o modo para um determinado aplicativo e operação.
get [--user &lt;USER_ID&gt;] &lt;PACKAGE | UID&gt; [&lt;OP&gt;]
  Retorne o modo para um determinado aplicativo e operação opcional.
query-op [--user &lt;USER_ID&gt;] &lt;OP&gt; [&lt;MODE&gt;]
  Imprime todos os pacotes que atualmente possuem a operação fornecida no modo fornecido.
reset [--user &lt;USER_ID&gt;] [&lt;PACKAGE&gt;]
  Redefine o aplicativo ou todos os aplicativos para os modos padrão.
write-settings
  Grava imediatamente as alterações pendentes no armazenamento.
read-settings
  Lê as últimas configurações escritas, substituindo o estado atual em RAM.
opções:
  &lt;PACKAGE&gt; um nome de pacote Android ou seu UID se prefixado por --uid
  &lt;OP&gt;      uma operação das Operações de aplicativo.
  &lt;MODE&gt;    um de permitir, ignorar, negar ou padrão
  &lt;USER_ID&gt; o id do usuário sob o qual o pacote está instalado. Se --user não for
            especificado, o usuário atual é assumido.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">06/01/2021 23:29:15</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/AppManager/pt-BR/tech/" class="prev router-link-active">
        Informações Técnicas
      </a></span> <span class="next"><a href="/AppManager/pt-BR/tech/rules-specification.html">
        App Manager: Especificação das Regras
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/AppManager/assets/js/app.5333276d.js" defer></script><script src="/AppManager/assets/js/2.b7ff2a34.js" defer></script><script src="/AppManager/assets/js/41.a4a19a19.js" defer></script>
  </body>
</html>
